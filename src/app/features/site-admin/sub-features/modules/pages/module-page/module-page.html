<div class="flex bg-white w-full h-full">
  <div class="flex-1 p-6">
    <h1 class="text-2xl mb-4 font-bold text-[#1D1D21]">Module Page</h1>
    <div class="my-3 flex justify-end">
      <app-button text="Export to Excel" variant="primary" (clicked)="exportToExcel()"></app-button>
    </div>
    <div class="module-table shadow-lg rounded-lg overflow-hidden">
      <table
        matSort
        (matSortChange)="announceSortChange($event)"
        mat-table
        [dataSource]="dataSource"
        cdkDropList
        [cdkDropListData]="modules()"
        (cdkDropListDropped)="drop($event)"
        class="w-full bg-white"
      >
        <ng-container matColumnDef="actions">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="p-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider"
          >
            Actions
          </th>
          <td mat-cell *matCellDef="let module" class="p-4 whitespace-nowrap">
            <span cdkDragHandle class="drag-handle mr-2 cursor-move" aria-label="Drag handle">
              <mat-icon>drag_indicator</mat-icon>
            </span>
            @if (editingModuleId() !== module.id) {
            <button
              (click)="editModule(module)"
              mat-icon-button
              color="primary"
              aria-label="Edit module"
            >
              <mat-icon>edit</mat-icon>
            </button>
            } @else {
            <button
              (click)="saveModule(module.id)"
              mat-icon-button
              color="primary"
              aria-label="Save module"
            >
              <mat-icon>save</mat-icon>
            </button>
            <button (click)="cancelEdit()" mat-icon-button color="warn" aria-label="Cancel edit">
              <mat-icon>cancel</mat-icon>
            </button>
            }
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="p-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider"
          >
            Status
          </th>
          <td mat-cell *matCellDef="let module" class="p-4 whitespace-nowrap">
            <mat-slide-toggle
              class="toggle"
              [checked]="module.status"
              (change)="toggleStatus(module)"
              [disabled]="editingModuleId() !== module.id"
              color="accent"
            ></mat-slide-toggle>
          </td>
        </ng-container>

        <ng-container matColumnDef="moduleName">
          <th
            mat-header-cell
            *matHeaderCellDef
            mat-sort-header
            sortActionDescription="Sort by module name"
            class="p-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider"
          >
            Module Name
          </th>
          <td mat-cell *matCellDef="let module" class="p-4 whitespace-nowrap">
            @if (editingModuleId() !== module.id) {
            {{ module.moduleName }}
            } @else {
            <mat-form-field appearance="outline" class="edit-field w-full">
              <input
                matInput
                [value]="editedModuleName()"
                (input)="editedModuleName.set($event.target.value)"
                placeholder="Module name"
              />
            </mat-form-field>
            }
          </td>
        </ng-container>

        <ng-container matColumnDef="description">
          <th
            mat-header-cell
            *matHeaderCellDef
            mat-sort-header
            sortActionDescription="Sort by description"
            class="p-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider"
          >
            Description
          </th>
          <td mat-cell *matCellDef="let module" class="p-4">
            @if (editingModuleId() !== module.id) {
            {{ module.description }}
            } @else {
            <mat-form-field appearance="outline" class="edit-field w-full">
              <input
                matInput
                [value]="editedModuleDescription()"
                (input)="editedModuleDescription.set($event.target.value)"
                placeholder="Description"
              />
            </mat-form-field>
            }
          </td>
        </ng-container>

        <ng-container matColumnDef="icon">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="p-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider"
          >
            Icon
          </th>
          <td mat-cell *matCellDef="let module" class="p-4 whitespace-nowrap">
            <mat-icon class="module-icon">{{ module.icon }}</mat-icon>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          cdkDrag
          [cdkDragData]="row"
          class="border-b border-gray-200 hover:bg-gray-100"
        ></tr>
      </table>
      <div class="flex items-center justify-between mt-4 px-3">
        <p class="text-sm text-[#182330] font-semibold">
          Showing 1 to 5 entries of {{ dataSource.data.length }} entries
        </p>
        <div>
          <mat-paginator
            [length]="dataSource.data.length"
            [pageSize]="5"
            [pageSizeOptions]="[5]"
            #paginator
            style="display: none"
          ></mat-paginator>

          <div class="flex justify-end items-center mt-4 space-x-4">
            <!-- Previous -->
            <button
              class="border border-[#CAC6D3] rounded"
              mat-icon-button
              (click)="paginator.previousPage()"
              [disabled]="paginator.hasPreviousPage() === false"
            >
              <mat-icon>chevron_left</mat-icon>
            </button>

            <!-- Current Page -->
            <span class="bg-[#6D7BFA] text-white px-3 py-1 rounded">{{
              paginator.pageIndex + 1
            }}</span>

            <!-- Next -->
            <button
              class="border border-[#CAC6D3] rounded"
              mat-icon-button
              (click)="paginator.nextPage()"
              [disabled]="paginator.hasNextPage() === false"
            >
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
